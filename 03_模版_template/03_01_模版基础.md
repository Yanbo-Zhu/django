
在之前的章节中，视图函数只是直接返回文本，而在实际生产环境中其实很少这样用，因为实际的页面大多是带有样式的HTML代码，这可以让浏览器渲染出非常漂亮的页面。目前市面上有非常多的模板系统，其中最知名最好用的就是DTL和Jinja2。DTL 是`Django Template Language `三个单词的缩写，也就是Django自带的模板语言。当然也可以配置Django支持Jinja2等其他模板引擎，但是作为Django内置的模板语言，和Django可以达到无缝衔接而不会产生一些不兼容的情况。因此建议大家学习好DTL。


Django 作为 Web框架，需要一种很便利的方法动态地生成HTML 网页，因此有了模板这个概念。模板包含所需HTML 的部分代码以及一些特殊语法，特殊语法用于描述如何将视图传递的数据动态插入HTML 网页中。

Django可以配置一个或多个模板引擎(甚至是О个，如前后端分离，Django只提供API接口，无须使用模板引擎)，模板引擎有Django模板语言（Django Template Language，DTL)和Jinja3。
Django模板语言是Django 内置的功能之一，Jinja3是当前Python流行的模板语言。
本章分别讲述Django模板语言和Jinja3的使用方法。

首先在项目根目录下创建 templates 文件夹，用来放视图模版，然后在项目下的 settings.py 文件中注册 templates 文件夹，使 django 能够在 templates 文件夹中找到相应的模版，在 TEMPLATES 中的 DIRS 列表中加入如下代码
   ```python
   'DIRS': [os.path.join(BASE_DIR, 'templates')],
   ```


# 1 DTL与普通的HTML文件的区别



DTL模板是一种带有特殊语法的HTML文件，这个HTML文件可以被Django编译，可以传递参数进去，实现数据动态化。在编译完成后，生成一个普通的HTML文件，然后发送给客户端。

Django 内置的模板引擎包含模板上下文（亦可称为模板变量)、标签和过滤器，各个功能说明如下:
- 模板上下文是以变量的形式写入模板文件里面，变量值由视图函数或视图类传递所得。
- 标签是对模板上下文进行控制输出，比如模板上下文的判断和循环控制等。
- 模板继承隶属于标签，它是将每个模板文件重复的代码抽取出来并写在一个共用的模板文件中，其他模板文件通过继承共用模板文件来实现完整的网页输出。
- 过滤器是对模板上下文进行操作处理，比如模板上下文的内容截取、替换或格式转换等。


# 2 渲染模板

渲染模板有多种方式。这里讲下两种常用的方式。

render_to_string ：找到模板，然后将模板编译后渲染成Python的字符串格式。最后再通过 HttpResponse 类包装成一个HttpResponse 对象返回回去。示例代码如下：

```python 
from django.template.loader import render_to_string
from django.http import HttpResponse
def book_detail(request,book_id):
    html = render_to_string("detail.html")
    return HttpResponse(html)
```



以上方式虽然已经很方便了。但是django还提供了一个更加简便的方式，直接将模板渲染成字符串和包装成HttpResponse 对象一步到位完成。示例代码如下：

```python
from django.shortcuts import render
def book_list(request):
    return render(request,'list.html') 
```

## 2.1 有参数导入

2. 在 templates 文件夹下再创建放应用模版的文件夹 例如 blog ，然后在 blog 创建 index.html 作为 index 视图的模版
   ```html
   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>{{ title }}</title>
   </head>
   <body>
   <h1>{{ welcome }}</h1>
   </body>
   </html>
   ```

3. 修改视图文件函数
   ```python
   from django.shortcuts import render

   def index(request):
   	# context 中的参数名和模版中 {{ }} 包裹的相同
   	return render(request, 'blog\index.html', context={
           'title': "My Blog Home",
           'welcome': "Welcome to My Blog"
   	})
   	
   # 或者可以用以下方法来写
   def index(request):
   	title = "My Blog Home"
   	welcome = "Welcome to My Blog"
   	return render(request, 'blog\index.html', locals())
   ```
   然后我们就可以看到如下的界面，django 会把 view 的值传到模版中去

   ![第一次使用模版](https://upload-images.jianshu.io/upload_images/2888797-99a3d2fad9cfa623.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

   使用模版的话，我们就需要了解一下模版内置的标签和过滤器，这对我们日后的开发可以提高很多效率


# 3 模版查找路径配置 

在项目的settings.py 文件中。有一个TEMPLATES 配置，这个配置包含了模板引擎的配置，模板查找路径的配置，模板上下文的配置等。模板路径可以在两个地方配置。

1. BACKEND: 用的那个模版引擎 
2. DIRS ：这是一个列表，在这个列表中可以存放所有的模板路径，以后在视图中使用render 或者 render_to_string 渲染模板的时候，会在这个列表的路径中查找模板。
3. APP_DIRS ：默认为True ，这个设置为True 后，会在INSTALLED_APPS 的安装了的APP 下的 templates 文件夹中查找模板。
    1. 由于Django针对TEMPLATES的默认的设置有`'APP_DIRS': True`，会自动到每一个app的`templates`目录下寻找模板文件

## 3.1 查找顺序

比如代码render('list.html') 。先会在DIRS 这个列表中依次查找路径下有没有这个 模板，如果有，就返回。如果DIRS 列表中所有的路径都没有找到，那么会先检查当前这个视图所 处的app 是否已经安装，如果已经安装了，那么就先在当前这个app 下的templates 文件夹中查找 模板，如果没有找到，那么会在其他已经安装了的app 中查找。如果所有路径下都没有找到，那么会抛出一个TemplateDoesNotExist 的异常。


## 3.2 例子 

![](03_模版_template/images/Pasted%20image%2020240616170621.png)


![](03_模版_template/images/Pasted%20image%2020240616165747.png)


```python

INSTALLED_APPS = [  
    'django.contrib.admin',  
    'django.contrib.auth',  
    'django.contrib.contenttypes',  
    'django.contrib.sessions',  
    'django.contrib.messages',  
    'django.contrib.staticfiles',  
    'home'   # 配合 'APP_DIRS': True, 这样才能在在 home这个app 中的 tempalte文件夹中的html 才能被 自动默认找到 
]


TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates']  # BASE_DIR 为项目的根路径 
        ,
        'APP_DIRS': True,  # 注意这里一定要配套 project 的 settings.py 中的 INSTALLED_APPS 一起使用 
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
            'builtins':['django.templatetags.static']
        },
    },
]
```




