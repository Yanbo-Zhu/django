
![](images/Pasted%20image%2020240615171403.png)


输入 url, 根据path 知道要呼叫那个视图函数, 通过这个函数 调取 数据库 中的某个 信息. 然后回传给user 

![](images/Pasted%20image%2020240615171653.png)

# 1 视图 views.py

视图一般都写在app 的views.py 中。并且视图的第一个参数永远都是request （一个 HttpRequest）对象。这个对象存储了请求过来的所有信息，包括携带的参数以及一些头部信息等。在视图中，一般是完成逻辑相关的操作。
比如这个请求是添加一篇博客，那么可以通过request来接收到这些数据，然后存储到数据库中，最后再把执行的结果返回给浏览器。视图函数的返回结果必须是 HttpResponseBase 对象或者子类的对象。

示例代码如下：

```
from django.http import HttpResponse
def book_list(request):
return HttpResponse("书籍列表！")
```


视图可以是函数，也可以是类，我们先学习函数视图，后面再学习类视图。


# 2 URL映射 urls.py 


视图写完后，要与URL进行映射，也即用户在浏览器中输入什么url 的时候可以请求到这个视图函数。
在用户输入了某个url ，请求到我们的网站的时候， django 会从项目的urls.py 文件中寻找对应的视图。
就是在 views.py 中 url 特定path 的 对应的 function,

在urls.py 文件中有一个urlpatterns 变量，以后django 就会从这个变量中读取所有的匹配规则。匹配规则需要使用django.urls.path 函数进行包裹，这个函数会根据传入的参数返回URLPattern 或者是URLResolver 的对象。

示例代码如下
```python 
from django.contrib import admin
from django.urls import path
from book import views
urlpatterns = [
path('admin/', admin.site.urls),
path('book/',views.book_list)
]
```


例子 2
![](images/Pasted%20image%2020240616112122.png)

呼叫 `http://127.0.0.1:8000/s` 就就会呼叫 index 这个 定义好的 function 了


## 2.1 URL中添加参数

有时候， url 中包含了一些参数需要动态调整。比如简书某篇文章的详情页的url，是` https://www.jianshu.com/p/a5aab9c4978e `后面的a5aab9c4978e 就是这篇文章的id ，那么简书的 文章详情页面的url就可以写成 `https://www.jianshu.com/p/<id>` ，其中id就是文章的id。

那么如何在 django 中实现这种需求呢。这时候我们可以在path 函数中，使用尖括号的形式来定义一个参数。比如 我现在想要获取一本书籍的详细信息，那么应该在url 中指定这个参数。示例代码如下

```python 
from django.contrib import admin
from django.urls import path
from book import views
urlpatterns = [
    path('admin/', admin.site.urls),
    path('book/',views.book_list),
    path('book/<book_id>',views.book_detail)
]
```

而views.py 中的代码如下
```python 
def book_detail(request,book_id):
    text = "您输入的书籍的id是：%s" % book_id
    return HttpResponse(text)
```


---
1 
在指定参数时，也可以指定参数的类型，比如以上book_id 为整形，那么在定义URL 的时候，就可以使
用以下语法实现

```python 
path("book/<int:book_id>",views.book_detail)
```

除了int 类型， django 的path 部分还支持str 、slug 、uuid 、path 类型。

指定类型的好处: 
1. 如果输入的不符合类型, 就会出现404 错误: /book/abc 
2. 在视图函数中, 得到的book_id 的数据类型就自动转化成为 之前已经定义好的数据类型. 否则 默认的是 str 类型 



2 

当然，也可以通过查询字符串的方式传递一个参数过去。示例代码如下：
```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('book/',views.book_list),
    path('book/detail',views.book_detail)
]
```


在views.py 中的代码如下：
```python
def book_detail(request):
    book_id = request.GET.get("id")
    text = "您输入的书籍id是：%s" % book_id
return HttpResponse(text)
```


以后在访问的时候就是通过`/book/detail?id=1` 即可将参数传递过去。

---
也可以在path 中给出多个 值 

![](images/Pasted%20image%2020240616113658.png)






## 2.2 path 函数 

path 函数的定义为： path(route,view,name=None,kwargs=None) 。以下对这几个参数进行讲解。


### 2.2.1 route 参数

 url 的匹配规则。这个参数中可以指定url 中需要传递的参数，比如在访问文章详情
页的时候，可以传递一个id 。传递参数是通过<> 尖括号来进行指定的。并且在传递参数的时候，
可以指定这个参数的数据类型，比如文章的id 都是int 类型，那么可以这样写<int:id> ，以后匹
配的时候，就只会匹配到id 为int 类型的url ，而不会匹配其他的url ，并且在视图函数中获取
这个参数的时候，就已经被转换成一个int 类型了。

`path("book/<int:book_id>",views.book_detail)`
`/book/detail?id=1` 

其中还有几种常用的类型：
- str ：非空的字符串类型。默认的转换器。但是不能包含斜杠。  
    - `/book/<str:book_id>`, 比如写成/book/1/2,  那django 就不止 1/2 中间的/ 是要理解成url 中的 path, 还是 这个 book 的id 为 1/2, 具体的见下面的例子 
- int ：匹配任意的零或者正数的整形。到视图函数中就是一个int类型。
- slug ：由英文中的横杠- ，或者下划线_ 连接英文字符或者数字而成的字符串。如果是空格的话就会报错 
- uuid ：匹配uuid 字符串。
- path ：匹配非空的英文字符串，可以包含斜杠/ 。


例子
route 中 str 包含斜杠 的例子 
![](images/Pasted%20image%2020240616115121.png)


![](images/Pasted%20image%2020240616115342.png)

---


例子 2
route 中包含 slug 

![](images/Pasted%20image%2020240616115513.png)

![](images/Pasted%20image%2020240616115523.png)


例子3 
route 中 path 

![](images/Pasted%20image%2020240616115946.png)



### 2.2.2 view 参数：
可以为一个视图函数或者是类视图.as_view() 或者是django.urls.include() 函数
的返回值。

### 2.2.3 name 参数：
这个参数是给这个url 取个名字的，这在项目比较大， url 比较多的时候用处很大

![](images/Pasted%20image%2020240616120052.png)


## 2.3 url中包含另一个 urls 模块 

在我们的项目中，不可能只有一个app ，如果把所有的app 的views 中的视图都放在 项目入口的 urls.py 中进行映射，肯定会让代码显得非常乱。因此django 给我们提供了一个方法，可以在app 内部包含自己的url 匹配规则，而在项目的urls.py 中再统一包含这个app 的urls 。使用这个技术需要借助include 函数。

就是每个 app 有自己的 /urls.py , 然后再将app/urls.py  被include 到项目的 /urls.py  中 

示例代码如下：

在urls.py 文件中把所有的和book 这个app 相关的url 都移动到app/urls.py 中了，然后在 startdjango/urls.py 中，通过include 函数包含book.urls ，

startdjango/urls.py文件：
```python
from django.contrib import admin
from django.urls import path,include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('book/',include("book.urls"))  # 这里写了 book, 这说明 以后在请求book 相关的url的时候都需要加一个book 的前缀
]

```


book/urls.py文件
```python
from django.urls import path
from . import views
urlpatterns = [
    path('list/',views.book_list),
    path('detail/<book_id>/',views.book_detail)
]
```



以后在请求book 相关的url的时候都需要加一个book 的前缀
以后访问书的列表的url 的时候，就通过/book/list/ 来访问，访问书籍详情页面的url 的时候就通过`book/detail/<id> `来访问。

为了避免多个模块的urls.py 中包含同名的url ，可以指定一个应用命名空间, 使用 app_name='book'：

```python
# book/urls.py文件：
from django.urls import path
from . import views

app_name='book'  # 指定应用命名空间
urlpatterns = [
    path('list/',views.book_list),
    path('detail/<book_id>/',views.book_detail)
]
```


## 2.4 url反转

从视图函数到url的转换叫做反转url 

 反转url的用处:
- 在重定向的时候, 会使用url反转
- 在模版中, 也会使用url反转 

之前我们都是通过url来访问视图函数。有时候我们知道这个视图函数，但是想反转回他的url。 这时候就可以通过reverse 来实现。示例代码如下

### 2.4.1 介绍 

```python
from django.urls import reverse
```

```
reverse("list")
> /book/list/
```


1 
![](images/Pasted%20image%2020240616155643.png)

![](images/Pasted%20image%2020240616155752.png)

console中输出 单个斜杠 `/`  , 代表着 index 这个view 对应的 path


2

![](images/Pasted%20image%2020240616160213.png)

![](images/Pasted%20image%2020240616160156.png)

![](images/Pasted%20image%2020240616160546.png)


---
### 2.4.2 带命名空间 

如果有应用命名空间或者有实例命名空间，那么应该在反转的时候加上命名空间。示例代码如下：

```
reverse('book:list')
> /book/list/
```

![](images/Pasted%20image%2020240616161403.png)


![](images/Pasted%20image%2020240616161422.png)

![](images/Pasted%20image%2020240616161439.png)


### 2.4.3 kwargs 来传递参数

如果这个url中需要传递参数，那么可以通过kwargs 来传递参数。示例代码如下

```
reverse("book:detail",kwargs={"book_id":1})
> /book/detail/1

```


![](images/Pasted%20image%2020240616160928.png)

![](images/Pasted%20image%2020240616160953.png)



### 2.4.4 通过拼接的方式添加查询字符串的参数 

因为django 中的reverse 反转url 的时候不区分GET 请求和POST 请求，因此不能在反转的时候添加查询字符串的参数。如果想要添加查询字符串的参数，只能手动的添加。示例代码如下：

```
login_url = reverse('login') + "?next=/"
```

![](images/Pasted%20image%2020240616161112.png)















