
# 1 原理

在一个网页中，不仅仅只有一个html 骨架，还需要css 样式文件， js 执行文件以及一些图片等。 因此在DTL 中加载静态文件是一个必须要解决的问题。在DTL 中，使用static 标签来加载静态文件。要 使用static 标签，首先需要{% load static %} 。

加载静态文件的步骤如下：


1 首先确保django.contrib.staticfiles 已经添加到settings.INSTALLED_APPS 中。


2 确保在settings.py 中设置了STATIC_URL 。比如：`STATIC_URL = 'static/'`


3 在已经安装了的app 下创建一个文件夹叫做static ，然后再在这个static 文件夹下创建一个当前 app 的名字的文件夹，再把静态文件放到这个文件夹下。例如你的app 叫做book ，有一个静态文件叫做zhiliao.jpg ，那么路径为book/static/book/zhiliao.jpg 。

（为什么在app 下创建一个static 文件夹，还需要在这个static 下创建一个同app 名字的文件夹呢？原因是如果直接把静态文件放在static 文件夹下，那么在模版加载静态文件的时候就是使用zhiliao.jpg ，如果在多个app 之间有同名的静态文件，这时候可能就会产生混淆。而在static 文件夹下加了一个同名app 文件夹，在模版中加载的时候就是使用app/zhiliao.jpg ，这样就可以避免产生混淆。）


4 如果有一些静态文件是不和任何app 挂钩的。那么可以在settings.py 中添加
STATICFILES_DIRS ，以后DTL 就会在这个列表的路径中查找静态文件。比如可以设置为:

通过这步指定多个静态文件加载的路径 

```
STATICFILES_DIRS = [
os.path.join(BASE_DIR,"static")
]
```

![](images/Pasted%20image%2020240616191034.png)

这个路径代表整个project 直系下的文件夹 

![](images/Pasted%20image%2020240616191217.png)

5 在模版中使用load 标签加载static 标签。比如要加载在项目的static 文件夹下的style.css 的 文件

示例代码如下 

在 html 中 
```
{% load static %}
<link rel="stylesheet" href="{% static 'style.css' %}">
```

6
如果不想每次在模版中加载静态文件都使用load 加载static 标签，那么可以在settings.py 中 的TEMPLATES/OPTIONS 添加'builtins':['django.templatetags.static'] ，这样以后在模版 中就可以直接使用static 标签，而不用手动的load 了。

```
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates']
        ,
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
            # 这里加载
            'builtins':['django.templatetags.static']
        },
    },
]
```


7
如果没有在settings.INSTALLED_APPS 中添加django.contrib.staticfiles 。那么我们就需要手动的将请求静态文件的url 与静态文件的路径进行映射了，这个操作通常用来加载媒体文件（上传的文件）。示例代码如下：

```
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    ...
] + static(settings.MEDIA_URL,document_root=settings.MEDIA_ROOT)
```

> 如果以后用户去访问 MEDIA_URL, 那就回 将 MEDIA_ROOT 路径下的 图片返回回来 


在settings.py 中的对MEDIA_URL 和MEDIA_ROOT 的配置如下：
```
MEDIA_ROOT = BASE_DIR / 'media'
MEDIA_URL= '/media/'
```

注意：静态文件和媒体文件，最好都是通过Nginx等专业的web服务器来部署，以上方式仅在开发阶段

![](images/Pasted%20image%2020240616193025.png)



# 2 例子

![](images/Pasted%20image%2020240616192243.png)

static.html
```html
<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <title>静态文件加载</title>  
    <link rel="stylesheet" href="{% static 'css/index.css' %}">  
    <script src="{% static 'js/index.js' %}"></script>  
</head>  
<body>  
<h1>知了课堂</h1>  
</body>  
</html>
```


urls.py
```python
from django.contrib import admin
from django.urls import path
from home import views
from django.conf.urls.static import static
from django.conf import settings

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', views.index, name='index'),
    path('baidu', views.baidu, name='baidu'),
    path('info', views.info, name='info'),
    path('if', views.if_view, name='if'),
    path('for', views.for_view, name='for'),
    path('with', views.with_view, name='with'),
    path('url', views.url_view, name='url'),
    path('book/<book_id>', views.book_detail, name='book_detail'),
    path('filter', views.filter_view, name='filter'),
    path('template/form', views.template_form, name='template_form'),
    path('sta', views.static_view, name='static_view')
]  + static(settings.MEDIA_URL,document_root=settings.MEDIA_ROOT)
```


home/views.py
```python
def static_view(request):
    return render(request, 'static.html')
```





